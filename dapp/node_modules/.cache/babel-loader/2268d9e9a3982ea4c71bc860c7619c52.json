{"ast":null,"code":"import _toConsumableArray from\"/workspace/box-defi/dapp/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _regeneratorRuntime from\"/workspace/box-defi/dapp/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/workspace/box-defi/dapp/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/workspace/box-defi/dapp/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useEffect,useState}from\"react\";import Watering from\"../assets/images/watering.gif\";import Growing from\"../assets/images/growing.gif\";// Types\nimport{BoxStage}from\"../redux/actions/farm\";// Operations\nimport{plantSeeds,waterPlants,harvest}from\"../operations/farm\";// Utils\nimport{seedsPerBox,waterPeriod}from\"../utils/global\";import{getHHMMString}from\"../utils/time\";// Hooks\nimport{useTypedSelector,useActions}from\"../hooks\";// Components\nimport Button from\"../components/Button\";// Local constants\nimport{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var PLANTS_PER_PAGE=10;var Farm=function Farm(){var _useState=useState(1),_useState2=_slicedToArray(_useState,2),page=_useState2[0],setPage=_useState2[1];var _useState3=useState(0),_useState4=_slicedToArray(_useState3,2),start=_useState4[0],setStart=_useState4[1];var _useState5=useState(3),_useState6=_slicedToArray(_useState5,2),end=_useState6[0],setEnd=_useState6[1];var _useState7=useState(1),_useState8=_slicedToArray(_useState7,2),filterOption=_useState8[0],setFilterOption=_useState8[1];var _useState9=useState([]),_useState10=_slicedToArray(_useState9,2),filteredBoxes=_useState10[0],setFilteredBoxes=_useState10[1];var _useActions=useActions(),setLoading=_useActions.setLoading,setSuccess=_useActions.setSuccess,setFailure=_useActions.setFailure;var _useTypedSelector=useTypedSelector(function(state){return state.wallet;}),tokenBalances=_useTypedSelector.tokenBalances;var _useTypedSelector2=useTypedSelector(function(state){return state.farm;}),boxes=_useTypedSelector2.boxes;// TODO: memoize\nvar pageArr=Array.from({length:Math.ceil(filteredBoxes.length/PLANTS_PER_PAGE)},function(_,i){return i+1;});var numNeedsWater=boxes.filter(function(box){return box.needsWater&&box.stage!==BoxStage.STAGE_6;}).length;var maxBoxes=Math.floor(parseInt(tokenBalances.SEED)/seedsPerBox);useEffect(function(){if(page<start+1){setStart(start-1);setEnd(end-1);}else if(page>end){setStart(start+1);setEnd(end+1);}},[page,setStart,setEnd,start,end]);useEffect(function(){setPage(1);// Safe-hatch for decrease in items\nswitch(filterOption){case 0:{// All\nsetFilteredBoxes(boxes);break;}case 1:{// Alive\nsetFilteredBoxes(boxes.filter(function(box){return box.stage!==BoxStage.DEAD;}));break;}case 2:{// Needs water\nsetFilteredBoxes(boxes.filter(function(box){return box.needsWater&&box.stage!==BoxStage.STAGE_6;}));break;}case 3:{// Harvestable\nsetFilteredBoxes(boxes.filter(function(box){return box.stage===BoxStage.STAGE_6;}));break;}}},[filterOption,boxes]);var handlePlantSeeds=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var op;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return plantSeeds(maxBoxes);case 3:op=_context.sent;if(!op){_context.next=11;break;}setLoading(\"Planting seeds\");_context.next=8;return op.send();case 8:_context.next=10;return _context.sent.confirmation(1);case 10:setSuccess(\"Planting of seeds succesful!\");case 11:_context.next=16;break;case 13:_context.prev=13;_context.t0=_context[\"catch\"](0);setFailure(\"Planting Failed: \".concat(_context.t0.message));case 16:case\"end\":return _context.stop();}}},_callee,null,[[0,13]]);}));return function handlePlantSeeds(){return _ref.apply(this,arguments);};}();var handleWaterPlants=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(keys){var op;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return waterPlants(keys);case 3:op=_context2.sent;if(!op){_context2.next=11;break;}setLoading(\"Watering Plants\");_context2.next=8;return op.send();case 8:_context2.next=10;return _context2.sent.confirmation(1);case 10:setSuccess(\"Watering succesful!\");case 11:_context2.next=16;break;case 13:_context2.prev=13;_context2.t0=_context2[\"catch\"](0);setFailure(\"Watering Failed: \".concat(_context2.t0.message));case 16:case\"end\":return _context2.stop();}}},_callee2,null,[[0,13]]);}));return function handleWaterPlants(_x){return _ref2.apply(this,arguments);};}();var handleHarvest=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(key){var op;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;_context3.next=3;return harvest(key);case 3:op=_context3.sent;if(!op){_context3.next=11;break;}setLoading(\"Harvesting Plant\");_context3.next=8;return op.send();case 8:_context3.next=10;return _context3.sent.confirmation(1);case 10:setSuccess(\"Harvest succesful!\");case 11:_context3.next=16;break;case 13:_context3.prev=13;_context3.t0=_context3[\"catch\"](0);setFailure(\"Harvest Failed: \".concat(_context3.t0.message));case 16:case\"end\":return _context3.stop();}}},_callee3,null,[[0,13]]);}));return function handleHarvest(_x2){return _ref3.apply(this,arguments);};}();// Generate an overlay for the boxes\nvar getOverlay=function getOverlay(box){if(box.stage===BoxStage.DEAD){return/*#__PURE__*/_jsxs(\"div\",{className:\"absolute left-0 bottom-0 h-full w-full rounded-xl bg-black bg-opacity-80 font-semibold text-white px-2 py-5 flex flex-col justify-evenly items-center text-center\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-emoji-frown text-6xl\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-3xl\",children:\"Dead\"})]});}else if(box.stage===BoxStage.STAGE_6){return/*#__PURE__*/_jsxs(\"div\",{className:\"absolute left-0 bottom-0 h-full w-full rounded-xl bg-black opacity-0 bg-opacity-0 hover:bg-opacity-80 hover:opacity-100 text-2xl font-semibold text-white px-2 py-5 flex flex-col justify-between items-center text-center\",children:[\"Plant Fully grown!\",/*#__PURE__*/_jsx(Button,{text:\"Harvest\",background:\"bg-green-600\",icon:\"flower3\",onClick:function onClick(){return handleHarvest(box.key);}})]});}else if(box.needsWater){return/*#__PURE__*/_jsxs(\"div\",{className:\"absolute left-0 bottom-0 h-full w-full rounded-xl bg-black opacity-0 bg-opacity-0 hover:bg-opacity-80 hover:opacity-100 text-lg font-semibold text-white px-2 py-5 flex flex-col justify-between items-center text-center\",children:[\"Water in \",getHHMMString(box.waterBy),/*#__PURE__*/_jsx(Button,{text:\"Water\",background:\"bg-blue-400\",icon:\"droplet\",onClick:function onClick(){return handleWaterPlants([box.key]);}})]});}else{return/*#__PURE__*/_jsxs(\"div\",{className:\"absolute left-0 bottom-0 h-full w-full rounded-xl bg-black opacity-0 bg-opacity-0 hover:bg-opacity-80 hover:opacity-100 font-semibold text-white px-2 py-5 flex flex-col justify-evenly items-center text-center\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-emoji-smile text-6xl\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-2xl\",children:\"Plant is healthy!\"})]});}};return/*#__PURE__*/_jsxs(\"div\",{className:\"font-secondary flex flex-col gap-y-6 2xl:w-10/12 m-auto\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"rounded-lg bg-white p-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"font-primary font-semibold text-fadedBlack text-xl\",children:\"Plant Boxes\"}),/*#__PURE__*/_jsxs(\"div\",{onClick:function onClick(){return setFilterOption((filterOption+1)%4);},className:\"py-1 px-6 rounded-full bg-fadedWhite font-medium text-lg cursor-pointer hover:opacity-75 transition-opacity duration-200\",children:[filterOption===0?\"All Boxes\":filterOption===1?\"Alive Boxes\":filterOption===2?\"Needs Water\":\"Harvestable\",/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-arrow-repeat ml-2\"})]})]}),filteredBoxes.length===0&&/*#__PURE__*/_jsx(\"div\",{className:\"text-center\",children:\"Nothing to show.\"}),/*#__PURE__*/_jsx(\"div\",{className:\"mt-6 grid grid-cols-2 md:grid-cols-5 gap-y-2\",children:filteredBoxes.slice((page-1)*PLANTS_PER_PAGE,page*PLANTS_PER_PAGE).map(function(box,index){return/*#__PURE__*/_jsxs(\"div\",{className:\"relative m-auto w-5/6 cursor-pointer pb-6\",children:[getOverlay(box),/*#__PURE__*/_jsx(\"img\",{className:\"w-5/6 m-auto\",alt:\"stage\",src:require(\"../assets/images/stages/\".concat(box.stage.toLowerCase(),\".png\")).default})]},index);})}),filteredBoxes.length!==0&&/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-center items-center mt-12\",children:[/*#__PURE__*/_jsx(\"i\",{onClick:function onClick(){return setPage(Math.max(1,page-1));},className:\"bi bi-caret-left-fill cursor-pointer text-lg\"}),pageArr.slice(start,end).map(function(i,index){return/*#__PURE__*/_jsx(\"div\",{onClick:function onClick(){return setPage(i);},className:\"rounded-lg cursor-pointer \".concat(page===i?\"bg-black text-white\":\"text-fadedBlack\",\" text-lg py-1.5 px-2.5 mx-1\"),children:i},index);}),/*#__PURE__*/_jsx(\"i\",{onClick:function onClick(){return setPage(Math.min(pageArr.length,page+1));},className:\"bi bi-caret-right-fill cursor-pointer text-lg\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 gap-6 lg:grid-cols-3\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col rounded-lg bg-white p-6\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"font-primary font-semibold text-fadedBlack text-xl\",children:\"Stats\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1 flex flex-col justify-evenly text-base\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\uD83C\\uDF30 Seeds / Box\"}),/*#__PURE__*/_jsxs(\"span\",{children:[(seedsPerBox/Math.pow(10,18)).toFixed(),\" SEED\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\u23F0 Watering Period\"}),/*#__PURE__*/_jsxs(\"span\",{children:[(waterPeriod/60000).toFixed(),\" Minutes\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\uD83D\\uDCE6 Alive Boxes\"}),/*#__PURE__*/_jsxs(\"span\",{children:[boxes.filter(function(box){return box.stage!==BoxStage.DEAD;}).length,\" Boxes\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\uD83D\\uDCA7 Needs Water\"}),/*#__PURE__*/_jsxs(\"span\",{children:[numNeedsWater,\" Boxes\"]})]}),boxes.filter(function(box){return box.waterBy!==0&&box.stage!==BoxStage.STAGE_6;}).length!==0&&/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\uD83D\\uDEB0 Next Watering by\"}),/*#__PURE__*/_jsx(\"span\",{children:getHHMMString(Math.min.apply(Math,_toConsumableArray(boxes.filter(function(box){return box.waterBy!==0&&box.stage!==BoxStage.STAGE_6;}).map(function(box){return box.waterBy;}))))})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\uD83E\\uDEB4 Harvestable\"}),/*#__PURE__*/_jsxs(\"span\",{children:[boxes.filter(function(box){return box.stage===BoxStage.STAGE_6;}).length,\" Boxes\"]})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col justify-between rounded-lg bg-white p-6\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"font-primary font-semibold text-fadedBlack text-xl\",children:\"Water All\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"mx-auto\",children:[/*#__PURE__*/_jsx(\"img\",{className:\"w-16 m-auto my-5\",alt:\"plant_watering\",src:Watering}),/*#__PURE__*/_jsx(\"div\",{className:\"m-auto\",children:/*#__PURE__*/_jsx(Button,{text:\"Water All Boxes\",textColor:\"text-white\",background:\"bg-blue-400\",icon:\"droplet\",disabled:numNeedsWater===0,onClick:function onClick(){return handleWaterPlants(boxes.filter(function(box){return box.needsWater;}).map(function(box){return box.key;}));}})})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col justify-between rounded-lg bg-white p-6\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"font-primary font-semibold text-fadedBlack text-xl\",children:\"Plant Seeds\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"mx-auto\",children:[/*#__PURE__*/_jsx(\"img\",{className:\"w-32 mx-auto pb-4\",alt:\"plant_watering\",src:Growing}),/*#__PURE__*/_jsx(\"div\",{className:\"m-auto\",children:/*#__PURE__*/_jsx(Button,{text:\"Plant Seeds\",textColor:\"text-white\",background:\"bg-green-500\",icon:\"flower3\",disabled:maxBoxes===0,onClick:handlePlantSeeds})})]})]})]})]});};export default Farm;","map":{"version":3,"sources":["/workspace/box-defi/dapp/src/pages/Farm.tsx"],"names":["useEffect","useState","Watering","Growing","BoxStage","plantSeeds","waterPlants","harvest","seedsPerBox","waterPeriod","getHHMMString","useTypedSelector","useActions","Button","PLANTS_PER_PAGE","Farm","page","setPage","start","setStart","end","setEnd","filterOption","setFilterOption","filteredBoxes","setFilteredBoxes","setLoading","setSuccess","setFailure","state","wallet","tokenBalances","farm","boxes","pageArr","Array","from","length","Math","ceil","_","i","numNeedsWater","filter","box","needsWater","stage","STAGE_6","maxBoxes","floor","parseInt","SEED","DEAD","handlePlantSeeds","op","send","confirmation","message","handleWaterPlants","keys","handleHarvest","key","getOverlay","waterBy","slice","map","index","require","toLowerCase","default","max","min","toFixed"],"mappings":"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","sourcesContent":["import { useEffect, useState } from \"react\";\n\nimport Watering from \"../assets/images/watering.gif\";\nimport Growing from \"../assets/images/growing.gif\";\n\n// Types\nimport { BoxStage, Box } from \"../redux/actions/farm\";\n\n// Operations\nimport { plantSeeds, waterPlants, harvest } from \"../operations/farm\";\n\n// Utils\nimport { seedsPerBox, waterPeriod } from \"../utils/global\";\nimport { getHHMMString } from \"../utils/time\";\n\n// Hooks\nimport { useTypedSelector, useActions } from \"../hooks\";\n\n// Components\nimport Button from \"../components/Button\";\n\n// Local constants\nconst PLANTS_PER_PAGE = 10;\n\nconst Farm = () => {\n  const [page, setPage] = useState<number>(1);\n  const [start, setStart] = useState<number>(0);\n  const [end, setEnd] = useState<number>(3);\n  const [filterOption, setFilterOption] = useState<number>(1);\n  const [filteredBoxes, setFilteredBoxes] = useState<Box[]>([]);\n\n  const { setLoading, setSuccess, setFailure } = useActions();\n  const { tokenBalances } = useTypedSelector((state) => state.wallet);\n  const { boxes } = useTypedSelector((state) => state.farm);\n\n  // TODO: memoize\n  const pageArr = Array.from({ length: Math.ceil(filteredBoxes.length / PLANTS_PER_PAGE) }, (_, i) => i + 1);\n  const numNeedsWater = boxes.filter((box) => box.needsWater && box.stage !== BoxStage.STAGE_6).length;\n  const maxBoxes = Math.floor(parseInt(tokenBalances.SEED) / seedsPerBox);\n\n  useEffect(() => {\n    if (page < start + 1) {\n      setStart(start - 1);\n      setEnd(end - 1);\n    } else if (page > end) {\n      setStart(start + 1);\n      setEnd(end + 1);\n    }\n  }, [page, setStart, setEnd, start, end]);\n\n  useEffect(() => {\n    setPage(1); // Safe-hatch for decrease in items\n    switch (filterOption) {\n      case 0: {\n        // All\n        setFilteredBoxes(boxes);\n        break;\n      }\n      case 1: {\n        // Alive\n        setFilteredBoxes(boxes.filter((box) => box.stage !== BoxStage.DEAD));\n        break;\n      }\n      case 2: {\n        // Needs water\n        setFilteredBoxes(boxes.filter((box) => box.needsWater && box.stage !== BoxStage.STAGE_6));\n        break;\n      }\n      case 3: {\n        // Harvestable\n        setFilteredBoxes(boxes.filter((box) => box.stage === BoxStage.STAGE_6));\n        break;\n      }\n    }\n  }, [filterOption, boxes]);\n\n  const handlePlantSeeds = async () => {\n    try {\n      const op = await plantSeeds(maxBoxes);\n      if (op) {\n        setLoading(\"Planting seeds\");\n        await (await op.send()).confirmation(1);\n        setSuccess(\"Planting of seeds succesful!\");\n      }\n    } catch (err: any) {\n      setFailure(`Planting Failed: ${err.message}`);\n    }\n  };\n\n  const handleWaterPlants = async (keys: number[]) => {\n    try {\n      const op = await waterPlants(keys);\n      if (op) {\n        setLoading(\"Watering Plants\");\n        await (await op.send()).confirmation(1);\n        setSuccess(\"Watering succesful!\");\n      }\n    } catch (err: any) {\n      setFailure(`Watering Failed: ${err.message}`);\n    }\n  };\n\n  const handleHarvest = async (key: number) => {\n    try {\n      const op = await harvest(key);\n      if (op) {\n        setLoading(\"Harvesting Plant\");\n        await (await op.send()).confirmation(1);\n        setSuccess(\"Harvest succesful!\");\n      }\n    } catch (err: any) {\n      setFailure(`Harvest Failed: ${err.message}`);\n    }\n  };\n\n  // Generate an overlay for the boxes\n  const getOverlay = (box: Box) => {\n    if (box.stage === BoxStage.DEAD) {\n      return (\n        <div className=\"absolute left-0 bottom-0 h-full w-full rounded-xl bg-black bg-opacity-80 font-semibold text-white px-2 py-5 flex flex-col justify-evenly items-center text-center\">\n          <i className=\"bi bi-emoji-frown text-6xl\" />\n          <div className=\"text-3xl\">Dead</div>\n        </div>\n      );\n    } else if (box.stage === BoxStage.STAGE_6) {\n      return (\n        <div className=\"absolute left-0 bottom-0 h-full w-full rounded-xl bg-black opacity-0 bg-opacity-0 hover:bg-opacity-80 hover:opacity-100 text-2xl font-semibold text-white px-2 py-5 flex flex-col justify-between items-center text-center\">\n          Plant Fully grown!\n          <Button text=\"Harvest\" background=\"bg-green-600\" icon=\"flower3\" onClick={() => handleHarvest(box.key)} />\n        </div>\n      );\n    } else if (box.needsWater) {\n      return (\n        <div className=\"absolute left-0 bottom-0 h-full w-full rounded-xl bg-black opacity-0 bg-opacity-0 hover:bg-opacity-80 hover:opacity-100 text-lg font-semibold text-white px-2 py-5 flex flex-col justify-between items-center text-center\">\n          Water in {getHHMMString(box.waterBy)}\n          <Button text=\"Water\" background=\"bg-blue-400\" icon=\"droplet\" onClick={() => handleWaterPlants([box.key])} />\n        </div>\n      );\n    } else {\n      return (\n        <div className=\"absolute left-0 bottom-0 h-full w-full rounded-xl bg-black opacity-0 bg-opacity-0 hover:bg-opacity-80 hover:opacity-100 font-semibold text-white px-2 py-5 flex flex-col justify-evenly items-center text-center\">\n          <i className=\"bi bi-emoji-smile text-6xl\" />\n          <div className=\"text-2xl\">Plant is healthy!</div>\n        </div>\n      );\n    }\n  };\n\n  return (\n    <div className=\"font-secondary flex flex-col gap-y-6 2xl:w-10/12 m-auto\">\n      <div className=\"rounded-lg bg-white p-6\">\n        <div className=\"flex justify-between items-center\">\n          <div className=\"font-primary font-semibold text-fadedBlack text-xl\">Plant Boxes</div>\n          <div\n            onClick={() => setFilterOption((filterOption + 1) % 4)}\n            className=\"py-1 px-6 rounded-full bg-fadedWhite font-medium text-lg cursor-pointer hover:opacity-75 transition-opacity duration-200\"\n          >\n            {filterOption === 0\n              ? \"All Boxes\"\n              : filterOption === 1\n              ? \"Alive Boxes\"\n              : filterOption === 2\n              ? \"Needs Water\"\n              : \"Harvestable\"}\n            <i className=\"bi bi-arrow-repeat ml-2\" />\n          </div>\n        </div>\n        {filteredBoxes.length === 0 && <div className=\"text-center\">Nothing to show.</div>}\n        <div className=\"mt-6 grid grid-cols-2 md:grid-cols-5 gap-y-2\">\n          {filteredBoxes.slice((page - 1) * PLANTS_PER_PAGE, page * PLANTS_PER_PAGE).map((box, index) => (\n            <div key={index} className=\"relative m-auto w-5/6 cursor-pointer pb-6\">\n              {getOverlay(box)}\n              <img\n                className=\"w-5/6 m-auto\"\n                alt=\"stage\"\n                src={require(`../assets/images/stages/${box.stage.toLowerCase()}.png`).default}\n              />\n            </div>\n          ))}\n        </div>\n        {filteredBoxes.length !== 0 && (\n          <div className=\"flex justify-center items-center mt-12\">\n            <i\n              onClick={() => setPage(Math.max(1, page - 1))}\n              className=\"bi bi-caret-left-fill cursor-pointer text-lg\"\n            />\n            {pageArr.slice(start, end).map((i, index) => (\n              <div\n                key={index}\n                onClick={() => setPage(i)}\n                className={`rounded-lg cursor-pointer ${\n                  page === i ? \"bg-black text-white\" : \"text-fadedBlack\"\n                } text-lg py-1.5 px-2.5 mx-1`}\n              >\n                {i}\n              </div>\n            ))}\n            <i\n              onClick={() => setPage(Math.min(pageArr.length, page + 1))}\n              className=\"bi bi-caret-right-fill cursor-pointer text-lg\"\n            />\n          </div>\n        )}\n      </div>\n      <div className=\"grid grid-cols-1 gap-6 lg:grid-cols-3\">\n        <div className=\"flex flex-col rounded-lg bg-white p-6\">\n          <div className=\"font-primary font-semibold text-fadedBlack text-xl\">Stats</div>\n          <div className=\"flex-1 flex flex-col justify-evenly text-base\">\n            <div className=\"flex justify-between\">\n              <span>🌰 Seeds / Box</span>\n              <span>{(seedsPerBox / 10 ** 18).toFixed()} SEED</span>\n            </div>\n            <div className=\"flex justify-between\">\n              <span>⏰ Watering Period</span>\n              <span>{(waterPeriod / 60000).toFixed()} Minutes</span>\n            </div>\n            <div className=\"flex justify-between\">\n              <span>📦 Alive Boxes</span>\n              <span>{boxes.filter((box) => box.stage !== BoxStage.DEAD).length} Boxes</span>\n            </div>\n            <div className=\"flex justify-between\">\n              <span>💧 Needs Water</span>\n              <span>{numNeedsWater} Boxes</span>\n            </div>\n            {boxes.filter((box) => box.waterBy !== 0 && box.stage !== BoxStage.STAGE_6).length !== 0 && (\n              <div className=\"flex justify-between\">\n                <span>🚰 Next Watering by</span>\n                <span>\n                  {getHHMMString(\n                    Math.min(\n                      ...boxes\n                        .filter((box) => box.waterBy !== 0 && box.stage !== BoxStage.STAGE_6)\n                        .map((box) => box.waterBy)\n                    )\n                  )}\n                </span>\n              </div>\n            )}\n            <div className=\"flex justify-between\">\n              <span>🪴 Harvestable</span>\n              <span>{boxes.filter((box) => box.stage === BoxStage.STAGE_6).length} Boxes</span>\n            </div>\n          </div>\n        </div>\n        <div className=\"flex flex-col justify-between rounded-lg bg-white p-6\">\n          <div className=\"font-primary font-semibold text-fadedBlack text-xl\">Water All</div>\n          <div className=\"mx-auto\">\n            <img className=\"w-16 m-auto my-5\" alt=\"plant_watering\" src={Watering} />\n            <div className=\"m-auto\">\n              <Button\n                text=\"Water All Boxes\"\n                textColor=\"text-white\"\n                background=\"bg-blue-400\"\n                icon=\"droplet\"\n                disabled={numNeedsWater === 0}\n                onClick={() => handleWaterPlants(boxes.filter((box) => box.needsWater).map((box) => box.key))}\n              />\n            </div>\n          </div>\n        </div>\n        <div className=\"flex flex-col justify-between rounded-lg bg-white p-6\">\n          <div className=\"font-primary font-semibold text-fadedBlack text-xl\">Plant Seeds</div>\n          <div className=\"mx-auto\">\n            <img className=\"w-32 mx-auto pb-4\" alt=\"plant_watering\" src={Growing} />\n            <div className=\"m-auto\">\n              <Button\n                text=\"Plant Seeds\"\n                textColor=\"text-white\"\n                background=\"bg-green-500\"\n                icon=\"flower3\"\n                disabled={maxBoxes === 0}\n                onClick={handlePlantSeeds}\n              />\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default Farm;\n"]},"metadata":{},"sourceType":"module"}